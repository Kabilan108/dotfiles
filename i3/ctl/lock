#!/bin/bash

overlay=/usr/share/pixmaps/lockoverlay.png
suspend_flag=false

# Check for --suspend flag
for arg in "$@"
do
    if [ "$arg" == "--suspend" ]
    then
        suspend_flag=true
    fi
done

# take a fullscreen screenshot
scrot /tmp/currentworkspace.png

# Blur the screenshot
convert /tmp/currentworkspace.png -blur 0x5 /tmp/currentworkspaceblur.png

# Composite the overlay onto the blurred screenshot
composite -gravity center $overlay /tmp/currentworkspaceblur.png /tmp/lockbackground.png

# Lock the screen with the final image
i3lock -i /tmp/lockbackground.png --nofork &

# Wait a moment for the lock screen to activate
sleep 1

# If --suspend flag is present, suspend the system
if [ "$suspend_flag" = true ]
then
    systemctl suspend
fi

# Clean up temporary files
rm /tmp/currentworkspace.png /tmp/currentworkspaceblur.png /tmp/lockbackground.png
